# 2025/8/6 总结

ZRSC@JH 2025 D1

## T1 猜图游戏

第一眼看跟某道题非常像，不过那道题是树上的，但是这道题在图上，「图」没有告诉我们任何性质，因此可以等价看作 $n(n-1)/2$ 个 $0/1$ 变量。

##### 以下是一开始的思路

固定一个点 p，两两点之间询问？

则询问次数为 $4,851$

$x_i+x_j+x_{i,j}=v_{i,j}$

那么，相当于若干 $v_{i,j}-1\le x_i+x_j\le v_{i,j}$ 的不等式。

先处理 $v=0$，此时两者都只能是 $0$；

和 $v=3$，此时两者都只能是 $1$。

当 $v=1$ 时，两者中最多有一个 $1$，

当 $v=2$ 时，两者中至少有一个 $1$。

直接跑 2-SAT 即可。

但是貌似得到 2-SAT 后仍有多种方案，未决？

---

##### 以下是然后的思路

3 或者 0 的三元组其实比较多，可以一开始就随一个出来。

然后我们可以用一个「已知的集合」更新。be like

```c++
for(int i=1;i<=n;i++){
    int u=ord[i];
    if(u!=x&&u!=y&&u!=z){
        bool have0=0,have2=0;
        for(int j=1;j<known.size();j++){
            cono[j]=query(known[0],known[j],u)-conn[known[0]][known[j]];
            have0|=cono[j]==0;have2|=cono[j]==2;
        }
        assert(!(have0&have2));
        if(!(have0|have2)){
            if(query(known[1],known[2],u)-conn[known[1]][known[2]]==0) have2=1;
            else have0=1;
        }
        conn[known[0]][u]=have0?0:1;
        for(int j=1;j<known.size();j++)
            conn[known[j]][u]=cono[j]-conn[known[0]][u];
        known.push_back(u);
    }
}
```

然后拿了 61.58 分。

![细节](https://i.mji.rip/2025/08/06/1b9a3ef8946a74b8625f0d8c4feced1a.png)

细节 60+30=100

##### std

其实赛时已经差不多想到了，只差临门一脚，要是多想个 5 分钟或许就想到了（碎碎念

注意到正解要求平均每次询问确定两条边，但是我们上面的算法只能确定一条边。

毫无疑问，我们需要把 `known` 中的点两两配对，如果结果是 0 或者 2 肯定就能确定这两条边了，如果是 1 则意味着这两条边的存在性不同。赛时的思路是把所有的 1 的点继续随机配对，但是这个算法的期望询问次数没有变；或者是带着这个「不同」的限制继续做，但是不会。

正解：考虑把这两个点缩起来，把两个缩完的点之间各找一个问一次，有 $\frac12$ 的概率可以得到这四个元素，否则继续缩，这样就做完了。~~我真是个笨蛋~~

# T2 猜数游戏

写了一个 $n^3$ 的区间 DP，写成记搜理论 60 分，实际 TLE 挂了 5 分（挂成 55 分）。

##### 正解

这其实是一道 DS 题。

尽管这道题的单调性很奇怪，但还是可以考虑值域状态互换的 Trick。

其实只要你 **鼓起勇气** 就会发现它是可以转移的。

设 $gl(l,x)$ 表示 $fl(l,r)\le x$ 的 $r$ 的最大值，$gr(r,x)$ 同理。

考虑 $gl(l,x)$ 的转移，相当于找到一个 $p$，满足 $gr(p-1,x-1-dist(l-1,p))\le l$，且使 $gl(p+1,x-1-dist(l-1,p))$ 最大。

接下来开始利用 dist 的性质：考虑把每个数的某些字符置为空，使得转化后两个串相同，最小的转化次数。这样我们就可以用 $2^5$ 的代价把这个 dist 去掉了。

枚举 $p$ 的变化后，它会 ckmax 的部分即一个后缀的与自己变化后相同的数，所以可以从小到大枚举 $x$ 后扫描线更新做到线性。

如何询问？相当于二分 $x$ 使得存在 $p$ 使得 $gl(p+1,x)\ge R$ 且 $gr(p-1,x)\le L$，查询区间 min/max 可以用 ST 表之类的，但是没必要，直接 $O(n)$ 扫一遍就可以了。。。

# T3 集合游戏

推半天式子没推出来，看来还是得加训 D2T2（

莫名其妙的 <font color= red>RE</font> 挂了 13 分。

其实不用 FWT EXP 什么的，只是推式子罢了。

赛时的想法是 $\prod(1+xy^{a_i})$，其中 $x$ 是普通的加法卷积，$y$ 是异或卷积。然后答案是 $\sum_i\binom{2i}k[x^i]$。

然后你发现你光是计算「答案」这一部分就是 $O(n2^m)$ 了……（而且出题人甚至没给这一部分分

正解的想法是把 $\binom {2i}k$ 塞进多项式里，赛时没想到，其实直接考虑组合意义就可以了……

考虑每个 $C$ 中的元素，要么被选入 $A$，要么被选入 $B$，要么都选入，要么都不被选入，所以只用
$$
\prod(1+(1+x)^2y^{a_i})
$$
然后答案就是 $[x^k]$。~~其实直接推式子也很简单~~

对于这种毒瘤的二元生成函数问题无论先做第一维还是先做第二维都是可以的，这里不妨把 $x$ 相同的称为「行」，$y$ 相同的称为「列」，即排成 $n\times 2^m$ 的矩阵。那么我们需要求的是一堆矩阵的卷积的第 $k$ 行。

对于一个 $1+(1+x)^2y^{a_i}$ 直接对其做 FWT 则其 $y^s$ 项系数为 $1+(-1)^{|s\cap a_i|}(1+x)^2$。

因此，答案的 FWT 可以表示为 $(1+(1+x)^2)^{c_0(s)}(1-(1+x)^2)^{c_1(s)}$。

其中 $c_{0/1}(s)$ 表示与 $s$ 之交的大小为 偶数/奇数 的 $a_i$ 的个数。

怎么算？$c_0(s)-c_1(s)=\mathrm{FWT}(\#a)_s$ ~~赛时就是这个推了半天~~

然后怎么做？直接多项式快速幂不太好，因为只需要提取第 $k$ 项系数，考虑记 $c=c_0(s)$，那么 $c_1(s)=n-c$，则一个 $s$ 其贡献的「不同」点仅在于这个 $c$，考虑如何用 NTT 得到以 $c$ 为变元的上式的数列
$$
\begin{aligned}
&[x^k](1+(1+x)^2)^c(1-(1+x)^2)^{n-c}\\
&=[x^k](-1)^{n-c}(x^2+2x+2)^c(x^2+2x)^{n-c}\\
&=[x^k](-1)^{n-c}\sum_{i=0}^c\binom ci2^i(x^2+2x)^{n-i}\\
&=(-1)^{n-c}\sum_{i=0}^c[x^{k-(n-i)}]\binom ci2^i(x+2)^{n-i}\\
&=(-1)^{n-c}\sum_{i=0}^c[x^{k-(n-i)}]\binom ci2^i\sum_{j=0}^{n-i}\binom{n-i}j2^{n-i-j}x^j\\
&=(-1)^{n-c}\sum_{i=0}^c\binom ci2^i\binom{n-i}{k-(n-i)}2^{n-i-(k-(n-i))}\\
&=(-1)^{n-c}\left[\frac{x^c}{c!}\right]\left(\sum_{i=0}^n\binom{n-i}{k-(n-i)}2^{2n-i-k}\frac{x^i}{i!}\right)\times e^x\\
\end{aligned}
$$
然后就做完了，~~看上去很有组合意义的样子~~。