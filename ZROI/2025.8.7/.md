## T1

数组开小挂了一些分，还有一些 WA 掉了？？？

赛时思路：

考虑多项式，答案就是 $[x^ny^{\le \ln m}]e^{\sum xy^{\ln i}}$。然后就不会了。。。

---

考虑令 $k=\prod a_i$，先对 $k$ 进行质因分解。

显然每个质数位上是独立的，记在 $p$ 上是 $p^\alpha$……

等等这独立个鬼啊

---

然后写了一个异常丑陋的东西，基于几个发现

- $>\sqrt m$ 的数至多选一个
- 除掉 $1$ 以外，最多选 $\log_2 m$ 个数

所以可以 DP，做到 $O(\sqrt m \log^3 m+m\log m)$，但是空间复杂度 $O(m\log m)$。理论能过 $m\le 10^6$ 的档然后拿 $92$ 分，结果挂飞了。

---

正解：

哈哈我是傻呗

其实是独立的。

然后答案就是 $f(k)=\prod\binom{\alpha+n-1}{n-1}$。

因为是积性函数直接线性筛就完了


## T2

赛时想了一个假做法，猜想 Alice 和 Bob 是相邻的，第四个大样例过不了，捞了 48 pts，~~跟判断直径奇偶性得分一样~~。

正解：

考虑把 Alice 和 Bob 所在的点之间的链拎出来，那么，他们的策略一定为

- 先各自相向而行一段时间，这是为了堵另一个人
- 如果一方觉得自己赢麻了，就拐到某个支链去，此时可以直接结算了。
- 因此一方继续相向而行当且仅当当前点的支链不足以支撑他赢麻

这样可以做到 正确的 $O(n^3)$。

---

注意到 如果 Alice 的最长链跟次长链不同，则 Bob 必胜，因为 Bob 可以占在她的最长链儿子上。

很明显「最长链」是 Alice 到直径的两个端点之一，因此 Alice 必胜的必要条件需要

- 直径长度为偶数
- Alice 占在直径中点上

这样可以优化到 $O(n^2)$。

---

根据上面的策略，我们发现谁能赢取决于**谁先赢麻**，跟另一个人想的怎么样没什么关系，因为在发生「结算」事件之前两个人走的方向都是固定的，因此我们求出：

- 最小的 $a$ 使得 Alice 和 Bob 各自相向走 $a$ 步后，Alice 此时进入支链能胜利
- 最小的 $b$ 使得 Alice 走了 $b+1$ 步，Bob 走了 $b$ 步后，Bob 此时进入支链能胜利

则 Alice 获胜当且仅当 $a\le b$。

记 $v_0,\dots,v_d$ 表示当前 Alice 到 Bob 的路径，$l_i$ 表示 $v_i$ 上的支链长度。

那么 $a$ 需要满足的条件为 $l_a>\max_{a<k\le d-a} \{d-a-k+l_k\}$。

接下来是很神秘的一步：直接让 Bob 走到 $a+1$ 后不走了，得到一个必要条件 $l_a>d-a-(a+1)=d-2a-1$

于是得到 $d\le l_a+2a$。

注意到 $l_a$ 比较大的点其实比较小。因此考虑 **根号分治**。

如果 $l_a\le B$，那么 $\frac{d-B}2\le a<d$，这类 $a$ 可以暴力枚举。

如果 $l_a>B$，此类 $a$ 的数量比较少，可以挂在栈里枚举。

得到一个 $a$ 之后可以用 ST 表判断是否合法。因为 ST 表是可以 $O(\log n)$ 的时间在尾部增删元素的（因为每个 ST 表内的元素只维护当前点向前的一段的信息

然后就非常暴力的做完了。

## T3

记 $s_i=\sum_{j=1}^i cnt_j$ 表示当前 $a\le i$ 的个数，容易瞪出来答案就是 $\max\lceil\frac{s_i}i\rceil$。~~之前好像见过这个结论~~

本来写了一个 KTT，不过太难写了没调完，就交了一个 $O(n^2)$ 的暴力。

正解：

考虑维护 $s_i\bmod i$，那么每次从 $0$ 加到 $1$ 该点的答案就增加 $1$。

所有的 $s$ 的值域都在 $[0,n]$，因此所有的「增量次数」之和是 $O(n\log n)$ 的。

上面的不是很好搞，如果让 $s\gets s-1$，那么当 $i-1$ 加到 $0$ 时该点答案增加 $1$，但是这样维护区间最大值也没用；不如让 $s\gets -s$，那么当从 $0$ 减到 $s-1$ 时该点答案增加 $1$。

所以可以维护区间最小值，这个做法貌似就是 $O(n\log n)$ 的了

注意到只有 $\lceil\frac{s_i}i\rceil> \mathrm{ans}$ 的 $i$ 才是有用的，其中 ans 表示当前答案，那么 $i<\frac{s_i}{\mathrm{ans}}\le \frac{n}{\mathrm{ans}}$。

说明每次只用保留这么些东西，其实直接暴力维护就是对的了。。。

貌似还有离线之后按值域扫描线的方法，或者凸包，总之做法很多的，没有多想真是太亏了