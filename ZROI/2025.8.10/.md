# T1

终于（又）签上到了。

打表发现如果最小值是 $k$，那么答案就是 $\sum_{i=k}^m{m\brace i}$。

最小值是 $n-$ 最长上升后缀区间的长度。~~这个想了半天~~

其实正解应该是 DP，不过我 DP 太菜了。

# T2

很神秘，写的贪心 WA 掉了，不想调，然后写了一个费用流，只过了 10 pts。

其实本质就是模拟费用流吧（

~~再给我点时间就能想到了~~

赛时注意到任意一个串的最大匹配都形如 $)))((($ 的形式，可以用栈线性求出。

括号匹配岂是如此不便之物？有无快速计算的公式！

令左括号为 $1$，右括号为 $-1$，前缀和 $s$，那么最大匹配数为 $(n-s_n)/2+\min s_i$，即右括号的个数 + 折线图的最低点。

答案即是找 $k$ 个同色匹配，使强制~~钦定~~指定这些匹配后，匹配数不变。即 $s_{[x_i,y_i)}$ 减一后，$\min s_i$ 不变。

可以用网络流~~或者我的错误贪心~~证明，选择的匹配一定是 对同色进行贪心括号匹配 后的若干对匹配。

直接按右端点排序，贪心做就好了，用线段树维护。

# T3

赛时再给点时间也许能想出来吧。

### 若 $2m\le n$

此时因为 $m$ 比较小，可以发现这棵树的分叉不会太多太大。

可以把它的移动近似看作一个拓扑序，显然它是只能线性移动的（因为不能掉头）

因此答案非 $0$ 的树一定形如：中间一条长度为 $n-2m+1$ 的链，且两旁挂着大小为 $m$ 的子树，这两个子树分别为 $p_{[1,m]}$ 和 $p_{[n-m+1,n]}$。

$p$ 合法当且仅当 $p_{[1,m]}$ 和 $p_{[n-m+1,n]}$ 是这两棵子树的拓扑序，且 $p_{[m+1,n-m]}$ 是中间的链。树上拓扑序计数是经典问题。

所以为什么没有这一档部分分啊

### 若 $2m>n$

首先注意到若 $[l_1,r_1]$ 和 $[l_2,r_2]$ 有交，那么若 $p_{[l_1,r_1]\cap [l_2,r_2]}$ 和 $p_{[l_1,r_1]\cup[l_2,r_2]}$ 都是连通的。

因此，可以发现 $p_{[n-m+1,m]}$ 连通。

同样，$\forall 1\le i\le m,p_{[i,m]}$ 和 $\forall n-m+1 \le i\le n,p_{[n-m+1,i]}$ 连通。

把 $p_{[n-m+1,m]}$ 删掉之后可以形成若干子树，每棵属于 $p_{[1,m]}$ 和 $p_{[n-m+1,n]}$ 之一，同时 $p_{[1,m]}$ 和 $p_{[n-m+1,n]}$ 是其拓扑序。

以重心为根。于是，问题转化为：选择一个包含根，且大小为 $n-2m$ 的连通块，将它删掉后形成的子树划分为两块，且每一块的大小恰为 $n-m$。

$n-2m$ 的连通块内可以任意排，$n-m$ 的子树需要满足拓扑序。

可以树上背包，形如卷积，可以插值做到 $O(n^3)$。

或者可以用 DFS 序上 DP 的 Trick 来优化树上背包，可以直接做到 $O(n^3)$。