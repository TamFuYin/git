# T1

宝宝题，但是挂掉了

浪费一堆时间，想复杂了，艹！

如果两条路径有交，则可以看作一个等价类。

直接用并查集暴力搞就行了。

现在划分为若干两两不交的等价类，可以组织为虚树。

相当于选虚树上的一个连通块，即数连通块数，直接在连通块顶点处计数即可。

---

正解是神秘异或哈希，可以不用求 LCA，很强。

# T2

两次容斥。

分子：
$$
\binom mk\sum_{i=0}^k(-1)^{k-i}\binom ki\sum_{j=0}^{n-1}(-1)^j\binom{n-1}ji^{n-j}
$$
分母：
$$
\sum_{j=0}^{n-1}(-1)^j\binom{n-1}jm^{n-j}
$$
很明显是斯特林数
$$
\begin{aligned}
&\binom mk\sum_{i=0}^k(-1)^{k-i}\binom ki\sum_{j=0}^{n-1}(-1)^j\binom{n-1}ji^{n-j}\\
&=\binom mk\sum_{i=0}^k(-1)^{k-i}\binom ki\sum_{j=1}^n(-1)^{n-j}\binom{n-1}{j-1}\sum_{l=0}^j{j\brace l}i^{\underline{l}}\\
&=\sum_{l=0}^n\binom mk\sum_{i=0}^k(-1)^{k-i}\binom ki\sum_{j=1}^n(-1)^{n-j}\binom{n-1}{j-1}{j\brace l}\binom ill!\\
&=\sum_{l=0}^n\binom mk\sum_{i=0}^k(-1)^{k-i}\binom kl\binom{k-l}{i-l}\sum_{j=1}^n(-1)^{n-j}\binom{n-1}{j-1}{j\brace l}l!\\
&=\binom mk(-1)^{n+k}\sum_{l=0}^n\sum_{j=1}^n(-1)^{j}\binom kl\binom{n-1}{j-1}{j\brace l}l!\sum_{i=0}^{k-l}(-1)^i\binom{k-l}{i}\\
&=\binom mk(-1)^{n+k}\sum_{l=0}^n\sum_{j=1}^n(-1)^{j}\binom kl\binom{n-1}{j-1}{j\brace l}l!(-1)^l\sum_{i=0}^{k-l}(-1)^{i}\binom{k-l}{i}\\
&=\binom mk(-1)^{n+k}\sum_{l=0}^n\sum_{j=1}^n(-1)^{j}\binom kl\binom{n-1}{j-1}{j\brace l}l!(-1)^l[k=l]\\
&=\binom mk(-1)^nk!\sum_{j=1}^n(-1)^{j}\binom{n-1}{j-1}{j\brace k}\\
\end{aligned}
$$
注意到 ${n\brace m}=\sum_k(-1)^{n-k}\binom nk{k+1\brace m+1}$（见《具体数学》P221）。所以接下来
$$
=\binom mkk!{n-1\brace k-1}
$$
再整理一下分母
$$
\begin{aligned}
&\sum_k{n-1\brace k-1}m^{\underline k}\\
&=\sum_k{n-1\brace k}m^{\underline{k+1}}\\
&=m\sum_k{n-1\brace k}(m-1)^{\underline k}\\
&=m(m-1)^{n-1}\\
\end{aligned}
$$
显然是简单的。

上面就可以直接做 $O(nk)$，瓶颈在于预处理第二类斯特林数。

如果 $n$ 固定，可以卷积求一行 斯特林数。
$$
\sum_{m}{n\brace m}x^m=\left(\sum_{i\ge0 }\frac{i^nx^i}{i!}\right)\left(\sum_{i\ge0}\frac{(-1)^ix^i}{i!}\right)
$$
也有求一列斯特林数的方法
$$
\sum_{n}{n\brace m}\frac{x^n}{n!}=\frac{(\mathrm{e}^x-1)^m}{m!}
$$


---

似乎脑回路跟别人都不太一样？怎么别人都是用 DP 求的，就我暴力推了出来？？

正解是分块，但也有人离线 $O(nk)$ 硬操了过去。

ZR 机子太快了.jpg

# T3

黄瓜树（好独特的名词

没看题

---

总共有 $n-1$ 次操作，如果已经确定了合并顺序，如何确定**每一项**的组合意义？考虑从最后一次操作开始往前拆，对于一个连通块，可以拆出一个 $1$，然后后面就消失了；否则可以继续拆，我们可以认为这条边「断」开了。

因此最后形成若干连通块，考虑一个连通块划分合法的条件：

- 按顺序从后往前考虑每条边，如果一条边没有断开，那么它当前形成的连通块内也不能有边断开。

因此，对于每个连通块，其内部的每条边，都一定要比其连接外部连通块的边要晚。

不妨钦定每个连通块内的最早的边为*特殊边*，那么块内其他边一定比它晚，块外其他边一定比它早。

考虑设 $f_{i,j}$ 表示只考虑子树内的边，且已经有了特殊边，特殊边的排名为 $j$ 的方案数；$g_{i,j}$ 表示还没有特殊边，但是预定其排名为 $j$ 的方案数。

后面就是一些分讨了。